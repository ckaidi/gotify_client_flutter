# 系统托盘功能说明

## 🎯 功能概述

本应用已集成系统托盘功能，提供以下特性：

### ✨ 主要功能

1. **最小化到托盘**
   - 点击窗口的关闭按钮(❌)时，应用不会退出
   - 窗口将隐藏到系统托盘，应用继续在后台运行

2. **托盘图标状态指示**
   - ✅ **已连接**: 显示勾号(✓)表示与 Gotify 服务器连接正常
   - 🔄 **连接中**: 显示省略号(...)表示正在连接
   - 🔄 **重连中**: 显示循环箭头(↻)表示正在重连
   - ❌ **已断开**: 无特殊标记
   - ⚠️ **连接错误**: 显示感叹号(!)表示连接出错

3. **智能工具提示**
   - 悬停在托盘图标上显示当前状态
   - 显示消息数量（如果有未读消息）
   - 例如：`Gotify Client - 已连接 - 3 条消息`

### 🖱️ 操作方式

#### 托盘图标交互
- **单击托盘图标**: 切换窗口显示/隐藏状态
- **右键托盘图标**: 显示上下文菜单

#### 右键菜单选项
- **显示窗口**: 显示主窗口并将其置于前台
- **隐藏窗口**: 隐藏主窗口到托盘
- **关于**: 显示应用信息（待实现）
- **退出**: 完全退出应用程序

### 🔧 技术实现

#### 依赖库
- `system_tray: ^2.0.3`: 提供跨平台的系统托盘支持

#### 支持平台
- ✅ **macOS**: 完全支持，图标显示在菜单栏
- ✅ **Windows**: 完全支持，图标显示在任务栏通知区域
- ✅ **Linux**: 完全支持，图标显示在系统托盘

#### 窗口管理
- 使用 `WindowListener` 监听窗口关闭事件
- 在 `onWindowClose()` 方法中拦截关闭操作
- 支持的隐藏策略根据平台自动调整

### 📱 用户体验

#### 启动提示
- 应用启动后会在主界面显示托盘功能提示
- 提示文本：`点击关闭按钮将隐藏窗口到系统托盘，双击托盘图标可重新显示`

#### 状态同步
- 托盘图标状态与应用内连接状态实时同步
- 接收新消息时托盘提示会更新消息数量
- 清除消息后托盘提示也会相应更新

### 🛠️ 开发说明

#### 系统托盘服务 (`SystemTrayService`)
- 单例模式设计，全局可访问
- 自动检测平台支持性
- 提供初始化、状态更新、销毁等方法

#### 应用状态集成 (`AppState`)
- 在连接状态变化时自动更新托盘状态
- 在消息接收时更新托盘提示
- 在消息清除时同步托盘信息

#### 主程序集成 (`main.dart`)
- 应用启动时自动初始化系统托盘
- 继承 `WindowListener` 处理窗口事件
- 在 `onWindowClose()` 中实现隐藏逻辑

### 🐛 注意事项

1. **图标资源**
   - 当前使用应用默认图标 (`app_icon.png`)
   - 可根据需要为不同平台创建专用图标

2. **权限要求**
   - macOS 可能需要授权应用访问通知
   - 某些 Linux 桌面环境可能需要额外配置

3. **退出应用**
   - 通过托盘右键菜单的"退出"选项完全退出
   - 或在终端使用 Cmd+C/Ctrl+C 强制退出

### 🚀 使用建议

1. **日常使用**
   - 保持应用在托盘中运行，随时接收通知
   - 通过托盘图标快速了解连接状态
   - 需要查看消息时单击托盘图标显示窗口

2. **系统优化**
   - 应用在后台运行时占用资源很少
   - 可以设置开机自启动以便自动后台运行
   - 托盘功能不影响通知功能的正常工作

---

**更新时间**: 2025-09-04  
**功能版本**: v1.0.0  
**AI 辅助开发**: ✅