# GitHub Actions CI/CD å·¥ä½œæµç¨‹

æœ¬é¡¹ç›®åŒ…å«ä¸‰ä¸ªä¸»è¦çš„ GitHub Actions å·¥ä½œæµç¨‹ï¼Œç”¨äºè‡ªåŠ¨åŒ–æ„å»ºã€æµ‹è¯•å’Œå‘å¸ƒ Gotify Flutter å®¢æˆ·ç«¯ã€‚

## ğŸ“‹ å·¥ä½œæµç¨‹æ¦‚è§ˆ

### 1. ğŸ”„ Build on Push (`build-on-push.yml`)
**è§¦å‘æ¡ä»¶**: æ¯æ¬¡æ¨é€åˆ° `main`ã€`develop` æˆ– `feature/*` åˆ†æ”¯æ—¶

**åŠŸèƒ½**:
- å¿«é€Ÿæ„å»ºå’Œæµ‹è¯•ï¼ˆUbuntu ç¯å¢ƒï¼‰
- ä»£ç åˆ†æå’Œå•å…ƒæµ‹è¯•
- æ„å»º Android Debug APK å’Œ Web ç‰ˆæœ¬
- å¤šå¹³å°æ„å»ºçŸ©é˜µï¼ˆä»…åœ¨ main åˆ†æ”¯æˆ– PR æ—¶ï¼‰

**é€‚ç”¨åœºæ™¯**: æ—¥å¸¸å¼€å‘ä¸­çš„å¿«é€ŸéªŒè¯å’Œæµ‹è¯•

### 2. ğŸš€ CI/CD Pipeline (`ci-cd.yml`)
**è§¦å‘æ¡ä»¶**: 
- æ¨é€åˆ° `main` æˆ– `develop` åˆ†æ”¯
- é’ˆå¯¹ `main` åˆ†æ”¯çš„ Pull Request
- å‘å¸ƒæ–°ç‰ˆæœ¬æ—¶

**åŠŸèƒ½**:
- å®Œæ•´çš„æµ‹è¯•å¥—ä»¶
- æ„å»ºæ‰€æœ‰å¹³å°çš„å‘å¸ƒç‰ˆæœ¬ï¼š
  - Android (APK + AAB)
  - iOS (IPA)
  - Web
  - Windows (ZIP)
  - macOS (ZIP)
  - Linux (TAR.GZ)
- è‡ªåŠ¨ä¸Šä¼ æ„å»ºäº§ç‰©
- å‘å¸ƒæ—¶è‡ªåŠ¨åˆ›å»º GitHub Release

### 3. ğŸ“¦ Release (`release.yml`)
**è§¦å‘æ¡ä»¶**:
- æ¨é€ç‰ˆæœ¬æ ‡ç­¾ (å¦‚ `v1.0.0`)
- æ‰‹åŠ¨è§¦å‘å·¥ä½œæµç¨‹

**åŠŸèƒ½**:
- åˆ›å»ºæ­£å¼å‘å¸ƒç‰ˆæœ¬
- æ„å»ºæ‰€æœ‰å¹³å°çš„å‘å¸ƒç‰ˆæœ¬
- è‡ªåŠ¨ä¸Šä¼ åˆ° GitHub Releases
- åŒ…å«è¯¦ç»†çš„å‘å¸ƒè¯´æ˜

## ğŸ› ï¸ ä½¿ç”¨æŒ‡å—

### æ—¥å¸¸å¼€å‘
1. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯: `git checkout -b feature/your-feature`
2. æäº¤ä»£ç : `git push origin feature/your-feature`
3. è‡ªåŠ¨è§¦å‘å¿«é€Ÿæ„å»ºå’Œæµ‹è¯•

### å‘å¸ƒæ–°ç‰ˆæœ¬

#### æ–¹æ³•ä¸€: ä½¿ç”¨ Git æ ‡ç­¾
```bash
# åˆ›å»ºå¹¶æ¨é€ç‰ˆæœ¬æ ‡ç­¾
git tag v1.0.0
git push origin v1.0.0
```

#### æ–¹æ³•äºŒ: æ‰‹åŠ¨è§¦å‘
1. è®¿é—® GitHub Actions é¡µé¢
2. é€‰æ‹© "Release" å·¥ä½œæµç¨‹
3. ç‚¹å‡» "Run workflow"
4. è¾“å…¥ç‰ˆæœ¬å·ï¼ˆå¦‚ v1.0.0ï¼‰

### ç‰ˆæœ¬å·è§„èŒƒ
- ä½¿ç”¨è¯­ä¹‰åŒ–ç‰ˆæœ¬: `vä¸»ç‰ˆæœ¬.æ¬¡ç‰ˆæœ¬.ä¿®è®¢ç‰ˆæœ¬`
- ç¤ºä¾‹: `v1.0.0`, `v1.2.3`, `v2.0.0-beta.1`

## ğŸ“ æ„å»ºäº§ç‰©

### å¼€å‘æ„å»º (build-on-push)
- `quick-build-{commit-sha}`: åŒ…å« Android Debug APK å’Œ Web æ„å»º
- `{platform}-build-{commit-sha}`: å„å¹³å°çš„å‘å¸ƒæ„å»º

### æ­£å¼å‘å¸ƒ (release)
æ‰€æœ‰æ„å»ºäº§ç‰©ä¼šè‡ªåŠ¨ä¸Šä¼ åˆ° GitHub Releases:
- `gotify-client-android.apk` - Android å®‰è£…åŒ…
- `gotify-client-android.aab` - Google Play å‘å¸ƒåŒ…
- `gotify-client-ios.ipa` - iOS å®‰è£…åŒ…
- `gotify-client-windows.zip` - Windows å¯æ‰§è¡Œæ–‡ä»¶
- `gotify-client-macos.zip` - macOS åº”ç”¨ç¨‹åº
- `gotify-client-linux.tar.gz` - Linux å¯æ‰§è¡Œæ–‡ä»¶
- `gotify-client-web.zip` - Web åº”ç”¨æ–‡ä»¶

## âš™ï¸ é…ç½®è¯´æ˜

### Flutter ç‰ˆæœ¬
å½“å‰ä½¿ç”¨ Flutter 3.24.0 ç¨³å®šç‰ˆã€‚å¦‚éœ€æ›´æ–°ï¼Œè¯·ä¿®æ”¹å„å·¥ä½œæµç¨‹æ–‡ä»¶ä¸­çš„ `FLUTTER_VERSION` ç¯å¢ƒå˜é‡ã€‚

### å¹³å°æ”¯æŒ
- **Android**: API 21+ (Android 5.0+)
- **iOS**: iOS 12.0+
- **Windows**: Windows 10+
- **macOS**: macOS 10.14+
- **Linux**: Ubuntu 18.04+ æˆ–å…¶ä»–ç°ä»£ Linux å‘è¡Œç‰ˆ
- **Web**: ç°ä»£æµè§ˆå™¨

### ä¾èµ–é¡¹
å·¥ä½œæµç¨‹ä¼šè‡ªåŠ¨å®‰è£…ä»¥ä¸‹ä¾èµ–ï¼š
- Flutter SDK
- Java 17 (Android æ„å»º)
- Linux æ„å»ºä¾èµ– (clang, cmake, ninja-build, libgtk-3-dev ç­‰)

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ„å»ºå¤±è´¥ - ä¾èµ–é—®é¢˜**
   - æ£€æŸ¥ `pubspec.yaml` ä¸­çš„ä¾èµ–ç‰ˆæœ¬
   - ç¡®ä¿ `flutter pub get` èƒ½æ­£å¸¸è¿è¡Œ

2. **ä»£ç ç”Ÿæˆå¤±è´¥**
   - ç¡®ä¿ `build_runner` ä¾èµ–å·²æ·»åŠ åˆ° `dev_dependencies`
   - æ£€æŸ¥ç”Ÿæˆçš„æ–‡ä»¶æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯

3. **å¹³å°ç‰¹å®šæ„å»ºå¤±è´¥**
   - æ£€æŸ¥å¹³å°ç‰¹å®šçš„é…ç½®æ–‡ä»¶
   - ç¡®ä¿æ‰€æœ‰å¿…éœ€çš„æƒé™å’Œé…ç½®å·²è®¾ç½®

4. **å‘å¸ƒå¤±è´¥**
   - ç¡®ä¿æœ‰ `GITHUB_TOKEN` æƒé™
   - æ£€æŸ¥ç‰ˆæœ¬æ ‡ç­¾æ ¼å¼æ˜¯å¦æ­£ç¡®

### è°ƒè¯•æŠ€å·§

1. **æŸ¥çœ‹æ„å»ºæ—¥å¿—**
   - è®¿é—® GitHub Actions é¡µé¢æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   - å…³æ³¨å¤±è´¥æ­¥éª¤çš„é”™è¯¯ä¿¡æ¯

2. **æœ¬åœ°æµ‹è¯•**
   ```bash
   # è¿è¡Œä»£ç ç”Ÿæˆ
   flutter packages pub run build_runner build --delete-conflicting-outputs
   
   # ä»£ç åˆ†æ
   flutter analyze
   
   # è¿è¡Œæµ‹è¯•
   flutter test
   
   # æ„å»ºç‰¹å®šå¹³å°
   flutter build android --release
   flutter build web --release
   ```

3. **ç¼“å­˜é—®é¢˜**
   - å·¥ä½œæµç¨‹ä½¿ç”¨ç¼“å­˜æ¥åŠ é€Ÿæ„å»º
   - å¦‚é‡åˆ°ç¼“å­˜ç›¸å…³é—®é¢˜ï¼Œå¯ä»¥åœ¨ Actions é¡µé¢æ¸…é™¤ç¼“å­˜

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

- ä½¿ç”¨ Flutter ç¼“å­˜å‡å°‘ä¸‹è½½æ—¶é—´
- å¹¶è¡Œæ„å»ºå¤šä¸ªå¹³å°
- æ™ºèƒ½è§¦å‘æ¡ä»¶é¿å…ä¸å¿…è¦çš„æ„å»º
- æ„å»ºäº§ç‰©ä¿ç•™æœŸé™è®¾ç½®ï¼ˆå¼€å‘æ„å»º 7 å¤©ï¼Œå‘å¸ƒæ„å»º 30 å¤©ï¼‰

## ğŸ”’ å®‰å…¨è€ƒè™‘

- ä½¿ç”¨å®˜æ–¹ GitHub Actions
- æœ€å°æƒé™åŸåˆ™
- æ•æ„Ÿä¿¡æ¯ä½¿ç”¨ GitHub Secrets
- å®šæœŸæ›´æ–° Actions ç‰ˆæœ¬

---

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·åˆ›å»º Issue æˆ– Pull Requestã€‚